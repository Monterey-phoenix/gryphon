# This makefile does the following:
# * generates .py from .ui built using QT Designer.
#   We archive the generated .py file so that users do not
#   need to install pyuic5 and do not need to rebuild .py from .ui.
# * generates version_file.py to match VERSION defined here.
#   We archive version_file.py so users don't have to type "make" first.
# * Can generate the Windows installer, type "make win".
#
# You do not need to run this makefile unless you:
# * change a .ui file.
# * change the VERSION.
# * Want to generate a new Windows Installer and zip distribution:
#     update VERSION to current version then type "make dist"

#
# Modification History:
#   180803 David Shifflett
#     Changed dist to also depend on all
#

VERSION = Pre-Alpha-v0.3.9
WIN = MP_Gryphon_GUI-$(VERSION)-windowsinstaller.exe
ZIP_DIR = MP_Gryphon_GUI-$(VERSION)
ZIP = $(ZIP_DIR).zip

generated_files = \
	settings_dialog.py about_mp_dialog.py keyboard_dialog.py

.SUFFIXES: .ui .py

.ui.py:
	pyuic5 $< > $@

all: $(generated_files) version_file.py

dist: all win zip

version_file.py: Makefile
	@echo Updating version_file.py to $(VERSION)
	@echo "# This file is auto-generated by Makefile.  Do not edit this file." > version_file.py
	@echo "VERSION = \"$(VERSION)\"" >> version_file.py

win:
	@echo Making $(WIN)
	makensis -DVERSION=$(VERSION) build_installer.nsi
	@echo '**************** WINDOWS INSTALLER IS MADE ****************'

zip:
	rm -rf $(ZIP_DIR)
	mkdir $(ZIP_DIR)
	mkdir $(ZIP_DIR)/python
	cp *.py $(ZIP_DIR)/python
	mkdir $(ZIP_DIR)/python/examples
	cp examples/*.mp $(ZIP_DIR)/python/examples
	mkdir $(ZIP_DIR)/python/html
	cp html/*.html $(ZIP_DIR)/python/html
	mkdir $(ZIP_DIR)/python/icons
	cp icons/*.png $(ZIP_DIR)/python/icons
	mkdir $(ZIP_DIR)/python/images
	cp images/* $(ZIP_DIR)/python/images
	mkdir $(ZIP_DIR)/doc
	mkdir $(ZIP_DIR)/doc/mp_py_um
	cp ../doc/mp_py_um/mp_py_um.pdf $(ZIP_DIR)/doc/mp_py_um
	zip -r $(ZIP) $(ZIP_DIR)
	rm -rf $(ZIP_DIR)

# just clean distribution files
clean:
	/bin/rm -rf $(ZIP) $(WIN)

.PHONY: win zip
